-- CREATE TABLE proveedor (Ruc NUMBER(13,0) NOT NULL,
--                         Nombre VARCHAR2(50) NOT NULL,
--                         Direccion VARCHAR2(150) NOT NULL,
--                         Telefono NUMBER(10,0) NOT NULL,
--                         Email VARCHAR2(100) NOT NULL);
-- ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY(Ruc);

-- CREATE TABLE proveedor AS SELECT * FROM proveedor@UIO_CENTRAL;
-- ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY (Ruc);

CREATE MATERIALIZED VIEW proveedor REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM proveedor@UIO_CENTRAL;
-- ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY (Ruc);

CREATE MATERIALIZED VIEW producto REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM producto_central@UIO_CENTRAL;
-- ALTER TABLE producto_central ADD CONSTRAINT producto_pk PRIMARY KEY(Id);

-- CREATE TABLE producto_uio (Id NUMBER(20,0) NOT NULL,
--                             Stock NUMBER(3,0),
--                             Costo NUMBER(8,3) NOT NULL,
--                             Descripcion VARCHAR2(250),
--                             Marca VARCHAR2(20) NOT NULL,
--                             Modelo VARCHAR2(30) NOT NULL);
-- ALTER TABLE producto_uio ADD CONSTRAINT producto_uio_pk PRIMARY KEY(Id);

CREATE TABLE producto_uio (Id NUMBER(20,0) NOT NULL,
                            Stock NUMBER(3,0) NULL);
ALTER TABLE producto_uio ADD CONSTRAINT producto_uio_pk PRIMARY KEY(Id);
ALTER TABLE producto_uio ADD CONSTRAINT producto_uio_fk FOREIGN KEY (Id) REFERENCES producto_central (Id);

CREATE TABLE cliente_uio (Ruc_Cliente NUMBER(13,0) NOT NULL,
                            Nombre VARCHAR2(50) NOT NULL,
                            Direccion VARCHAR2(150) NOT NULL,
                            Telefono NUMBER(10,0) NOT NULL,
                            Email VARCHAR2(100) NOT NULL,
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE cliente_uio ADD CONSTRAINT cliente_uio_pk PRIMARY KEY(Ruc_Cliente);
ALTER TABLE cliente_uio ADD CONSTRAINT cliente_uio_ck CHECK(Ciudad='UIO');

CREATE TABLE proforma_uio (Id_Proforma VARCHAR2(17) NOT NULL,
                            Ruc_Cliente NUMBER(13,0) NOT NULL,
                            Placa VARCHAR2(8) NOT NULL,
                            Fecha DATE NOT NULL,
                            Total NUMBER(8,3) NULL,
                            Id_Factura VARCHAR2(17) NULL,
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE proforma_uio ADD CONSTRAINT proforma_uio_pk PRIMARY KEY (Id_Proforma);

CREATE TABLE factura_uio (Id_Factura VARCHAR2(17) NOT NULL,
                            Id_Proforma VARCHAR2(17) NOT NULL,
                            Fecha DATE NOT NULL,
                            Total NUMBER(8,3),
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE factura_uio ADD CONSTRAINT factura_uio_pk PRIMARY KEY (Id_Factura);
ALTER TABLE factura_uio ADD CONSTRAINT factura_uio_fk FOREIGN KEY (Id_Proforma) REFERENCES proforma_uio (Id_Proforma);

ALTER TABLE proforma_uio ADD CONSTRAINT proforma_uio_fk FOREIGN KEY (Id_Factura) REFERENCES factura_uio (Id_Factura);

ALTER TABLE factura_uio ADD CONSTRAINT factura_uio_ck CHECK(Ciudad='UIO');

ALTER TABLE proforma_uio ADD CONSTRAINT proforma_uio_ck CHECK(Ciudad='UIO');

-- CREATE TABLE auto (Id_Auto NUMBER GENERATED BY DEFAULT AS IDENTITY,
--                     Marca VARCHAR2(25) NOT NULL,
--                     Modelo VARCHAR2(25) NOT NULL,
--                     Cilindraje NUMBER(4,0) NOT NULL,
--                     Year DATE NOT NULL,
--                     Tipo VARCHAR2(20) NOT NULL);
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE VIEW auto AS SELECT * FROM auto@UIO_CENTRAL;
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE TABLE auto AS SELECT * FROM auto@UIO_CENTRAL;
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

CREATE MATERIALIZED VIEW auto REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM auto@UIO_CENTRAL;
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE TABLE facilita (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
--                         Id_Producto NUMBER(35) NOT NULL,
--                         Id_Proveedor NUMBER(13,0) NOT NULL);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_uio (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

-- CREATE TABLE facilita AS SELECT * FROM facilita@UIO_CENTRAL;
-- ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_uio (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

CREATE MATERIALIZED VIEW facilita REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM facilita@UIO_CENTRAL;
-- ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_uio (Id);
ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

CREATE TABLE cliente_auto (Placa VARCHAR2(8) NOT NULL,
                            Color VARCHAR2(12),
                            Id_Auto NUMBER NOT NULL,
                            Ruc_Cliente NUMBER(13,0) NOT NULL);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_pk PRIMARY KEY (Placa);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_fk_auto FOREIGN KEY (Id_Auto) REFERENCES auto (Id_Auto);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_fk_clie FOREIGN KEY (Ruc_Cliente) REFERENCES cliente_uio (Ruc_Cliente);

CREATE TABLE detalle_proforma (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
                                Id_Proforma VARCHAR2(17) NOT NULL,
                                Id_Producto NUMBER(35) NOT NULL,
                                Cantidad NUMBER(2) NOT NULL);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_pk PRIMARY KEY (Id);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_fk_prof FOREIGN KEY (Id_Proforma) REFERENCES proforma_uio (Id_Proforma);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_fk_Prod FOREIGN KEY (Id_Producto) REFERENCES producto_uio (Id);

CREATE TABLE detalle_factura (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
                                Id_Factura VARCHAR2(17) NOT NULL,
                                Id_Producto NUMBER(35) NOT NULL,
                                Cantidad NUMBER(2) NOT NULL);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_pk PRIMARY KEY (Id);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_fk_fact FOREIGN KEY (Id_Factura) REFERENCES factura_uio (Id_Factura);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_fk_Prod FOREIGN KEY (Id_Producto) REFERENCES producto_uio (Id);

-- -----------------------------------------------------------------------------------------------------------------
INSERT INTO producto_uio VALUES (12345678901234567890, 5);
INSERT INTO producto_uio VALUES (12345678901233367890, 7);
INSERT INTO producto_uio VALUES (12345678901777777890, 9);
INSERT INTO producto_uio VALUES (12311118901234567890, 12);

-- UPDATE producto_uio SET Stock = 5 WHERE Id = 12345678901234567890;
-- UPDATE producto_uio SET Stock = 7 WHERE Id = 12345678901233367890;
-- UPDATE producto_uio SET Stock = 9 WHERE Id = 12345678901777777890;
-- UPDATE producto_uio SET Stock = 12 WHERE Id = 12311118901234567890;

INSERT INTO cliente_uio VALUES (1721444801,'Ari Mendi','Av. El Inca y Av. Amazonas',022555551,'ariii@gmail.com','UIO');
INSERT INTO cliente_uio VALUES (1441517801,'Leo Gar','Av. El Inca y Av. La Prensa',022466688,'leogg@gmail.com','UIO');
INSERT INTO cliente_uio VALUES (1721887801,'Perito SaltaLa LLama','Av. Galo Plaza Lazo y Av. De El Maestro',022466688,'Pedrito@gmail.com','UIO');

INSERT INTO cliente_auto VALUES ('PCB-1111','GRIS',1,1721444801);
INSERT INTO cliente_auto VALUES ('PCB-2222','BLANCO',2,1721444801);
INSERT INTO cliente_auto VALUES ('GCB-8888','AZUL',3,1441517801);
INSERT INTO cliente_auto VALUES ('GCD-8844','AMARILLO',4,1721887801);

INSERT INTO proforma_uio VALUES ('001-002-124466789',1721444801,'PCB-1111',DATE '2021-12-19',175.85,NULL,'UIO');
INSERT INTO proforma_uio VALUES ('001-002-223419359',1721887801,'GCD-8844',DATE '2021-06-19',301.60,NULL,'UIO');

INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-124466789',12311118901234567890,1);
INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-124466789',12345678901777777890,1);
INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-223419359',12345678901777777890,2);

INSERT INTO factura_uio VALUES ('001-002-223419359','001-002-223419359',DATE '2021-06-19',301.60,'UIO');

INSERT INTO detalle_factura (Id_Factura,Id_Producto,Cantidad) VALUES ('001-002-223419359',12345678901777777890,2);

