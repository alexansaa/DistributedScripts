-- CREATE TABLE proveedor (Ruc NUMBER(13,0) NOT NULL,
--                         Nombre VARCHAR2(50) NOT NULL,
--                         Direccion VARCHAR2(150) NOT NULL,
--                         Telefono NUMBER(10,0) NOT NULL,
--                         Email VARCHAR2(100) NOT NULL);
-- ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY(Ruc);

-- CREATE TABLE proveedor AS SELECT * FROM proveedor@GYE_CENTRAL;
-- ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY (Ruc);

CREATE MATERIALIZED VIEW proveedor REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM proveedor@GYE_CENTRAL;
ALTER TABLE proveedor ADD CONSTRAINT proveedor_pk PRIMARY KEY (Ruc);

CREATE MATERIALIZED VIEW producto REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM producto@GYE_CENTRAL;
ALTER TABLE producto ADD CONSTRAINT producto_pk PRIMARY KEY(Id);

-- CREATE TABLE producto_gye (Id NUMBER(20,0) NOT NULL,
--                             Stock NUMBER(3,0),
--                             Costo NUMBER(8,3) NOT NULL,
--                             Descripcion VARCHAR2(250),
--                             Marca VARCHAR2(20) NOT NULL,
--                             Modelo VARCHAR2(30) NOT NULL);
-- ALTER TABLE producto_gye ADD CONSTRAINT producto_gye_pk PRIMARY KEY(Id);

CREATE TABLE producto_gye (Id NUMBER(20,0) NOT NULL,
                            Stock NUMBER(3,0) NULL);
ALTER TABLE producto_gye ADD CONSTRAINT producto_gye_pk PRIMARY KEY(Id);
ALTER TABLE producto_gye ADD CONSTRAINT producto_gye_fk FOREIGN KEY (Id) REFERENCES producto (Id);

CREATE TABLE cliente_gye (Ruc_Cliente NUMBER(13,0) NOT NULL,
                            Nombre VARCHAR2(50) NOT NULL,
                            Direccion VARCHAR2(150) NOT NULL,
                            Telefono NUMBER(10,0) NOT NULL,
                            Email VARCHAR2(100) NOT NULL,
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE cliente_gye ADD CONSTRAINT cliente_gye_pk PRIMARY KEY(Ruc_Cliente);
ALTER TABLE cliente_gye ADD CONSTRAINT cliente_gye_ck CHECK(Ciudad='GYE');

CREATE TABLE proforma_gye (Id_Proforma VARCHAR2(17) NOT NULL,
                            Ruc_Cliente NUMBER(13,0) NOT NULL,
                            Placa VARCHAR2(8) NOT NULL,
                            Fecha DATE NOT NULL,
                            Total NUMBER(8,3) NULL,
                            Id_Factura VARCHAR2(17) NULL,
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE proforma_gye ADD CONSTRAINT proforma_gye_pk PRIMARY KEY (Id_Proforma);

CREATE TABLE factura_gye (Id_Factura VARCHAR2(17) NOT NULL,
                            Id_Proforma VARCHAR2(17) NOT NULL,
                            Fecha DATE NOT NULL,
                            Total NUMBER(8,3),
                            Ciudad VARCHAR2(25) NOT NULL);
ALTER TABLE factura_gye ADD CONSTRAINT factura_gye_pk PRIMARY KEY (Id_Factura);
ALTER TABLE factura_gye ADD CONSTRAINT factura_gye_fk FOREIGN KEY (Id_Proforma) REFERENCES proforma_gye (Id_Proforma);

ALTER TABLE proforma_gye ADD CONSTRAINT proforma_gye_fk FOREIGN KEY (Id_Factura) REFERENCES factura_gye (Id_Factura);

ALTER TABLE factura_gye ADD CONSTRAINT factura_gye_ck CHECK(Ciudad='GYE');

ALTER TABLE proforma_gye ADD CONSTRAINT proforma_gye_ck CHECK(Ciudad='GYE');

-- CREATE TABLE auto (Id_Auto NUMBER GENERATED BY DEFAULT AS IDENTITY,
--                     Marca VARCHAR2(25) NOT NULL,
--                     Modelo VARCHAR2(25) NOT NULL,
--                     Cilindraje NUMBER(4,0) NOT NULL,
--                     Year DATE NOT NULL,
--                     Tipo VARCHAR2(20) NOT NULL);
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE VIEW auto AS SELECT * FROM auto@GYE_CENTRAL;
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE TABLE auto AS SELECT * FROM auto@GYE_CENTRAL;
-- ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

CREATE MATERIALIZED VIEW auto REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM auto@GYE_CENTRAL;
ALTER TABLE auto ADD CONSTRAINT auto_pk PRIMARY KEY (Id_Auto);

-- CREATE TABLE facilita (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
--                         Id_Producto NUMBER(35) NOT NULL,
--                         Id_Proveedor NUMBER(13,0) NOT NULL);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_gye (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

-- CREATE TABLE facilita AS SELECT * FROM facilita@GYE_CENTRAL;
-- ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_gye (Id);
-- ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

CREATE MATERIALIZED VIEW facilita REFRESH FAST ON DEMAND START WITH TO_DATE('27-07-2023 08:59:00','DD-MM-YYYY HH24:MI:SS') NEXT SYSDATE +1/1440 AS
SELECT * FROM facilita@GYE_CENTRAL;
ALTER TABLE facilita ADD CONSTRAINT facilita_pk PRIMARY KEY (Id);
ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prod FOREIGN KEY (Id_Producto) REFERENCES producto_gye (Id);
ALTER TABLE facilita ADD CONSTRAINT facilita_fk_prov FOREIGN KEY (Id_Proveedor) REFERENCES proveedor (Ruc);

CREATE TABLE cliente_auto (Placa VARCHAR2(8) NOT NULL,
                            Color VARCHAR2(12),
                            Id_Auto NUMBER NOT NULL,
                            Ruc_Cliente NUMBER(13,0) NOT NULL);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_pk PRIMARY KEY (Placa);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_fk_auto FOREIGN KEY (Id_Auto) REFERENCES auto (Id_Auto);
ALTER TABLE cliente_auto ADD CONSTRAINT cliente_auto_fk_clie FOREIGN KEY (Ruc_Cliente) REFERENCES cliente_gye (Ruc_Cliente);

CREATE TABLE detalle_proforma (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
                                Id_Proforma VARCHAR2(17) NOT NULL,
                                Id_Producto NUMBER(35) NOT NULL,
                                Cantidad NUMBER(2) NOT NULL);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_pk PRIMARY KEY (Id);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_fk_prof FOREIGN KEY (Id_Proforma) REFERENCES proforma_gye (Id_Proforma);
ALTER TABLE detalle_proforma ADD CONSTRAINT detalle_proforma_fk_Prod FOREIGN KEY (Id_Producto) REFERENCES producto_gye (Id);

CREATE TABLE detalle_factura (Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
                                Id_Factura VARCHAR2(17) NOT NULL,
                                Id_Producto NUMBER(35) NOT NULL,
                                Cantidad NUMBER(2) NOT NULL);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_pk PRIMARY KEY (Id);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_fk_fact FOREIGN KEY (Id_Factura) REFERENCES factura_gye (Id_Factura);
ALTER TABLE detalle_factura ADD CONSTRAINT detalle_factura_fk_Prod FOREIGN KEY (Id_Producto) REFERENCES producto_gye (Id);

-- -----------------------------------------------------------------------------------------------------------------
INSERT INTO producto_gye VALUES (12345678901234567890, 8);
INSERT INTO producto_gye VALUES (12345678901233367890, 10);
INSERT INTO producto_gye VALUES (12345678901777777890, 12);
INSERT INTO producto_gye VALUES (12311118901234567890, 14);

-- UPDATE producto_gye SET Stock = 8 WHERE Id = 12345678901234567890;
-- UPDATE producto_gye SET Stock = 10 WHERE Id = 12345678901233367890;
-- UPDATE producto_gye SET Stock = 12 WHERE Id = 12345678901777777890;
-- UPDATE producto_gye SET Stock = 14 WHERE Id = 12311118901234567890;

INSERT INTO cliente_gye VALUES (1721517801,'Juanito Pozo','Av. Juan Tanga Marengo km. 1 via la costa',022473551,'juanitop@gmail.com','GYE');
INSERT INTO cliente_gye VALUES (1441517801,'Maria Juliana','Av. Juan Tanga Marengo km. 1.8 via la Duran',022473588,'MariJuli@gmail.com','GYE');
INSERT INTO cliente_gye VALUES (1721887801,'Oswaldo Lizardo','Av. Juan Tanga Marengo km. 2 via la Duran',022333551,'OswiLiz@gmail.com','GYE');

INSERT INTO cliente_auto VALUES ('PCB-2972','GRIS',1,1721517801);
INSERT INTO cliente_auto VALUES ('PCB-2572','BLANCO',2,1721517801);
INSERT INTO cliente_auto VALUES ('GCB-2988','AZUL',3,1441517801);
INSERT INTO cliente_auto VALUES ('GCD-8872','AMARILLO',4,1721887801);

INSERT INTO proforma_gye VALUES ('001-002-123456789',1721517801,'PCB-2972',DATE '2022-12-19',175.85,NULL,'GYE');
INSERT INTO proforma_gye VALUES ('001-002-223455589',1721887801,'GCD-8872',DATE '2022-06-19',301.60,NULL,'GYE');

INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-123456789',12311118901234567890,1);
INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-123456789',12345678901777777890,1);
INSERT INTO detalle_proforma (Id_Proforma,Id_Producto,Cantidad) VALUES ('001-002-223455589',12345678901777777890,2);

INSERT INTO factura_gye VALUES ('001-002-223455589','001-002-223455589',DATE '2022-06-19',301.60,'GYE');

INSERT INTO detalle_factura (Id_Factura,Id_Producto,Cantidad) VALUES ('001-002-223455589',12345678901777777890,2);
